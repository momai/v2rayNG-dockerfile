# v2rayNG с автоматическим добавлением подписки

Этот проект предоставляет Docker-образ для сборки v2rayNG с автоматическим добавлением URL подписки во время сборки. При первом запуске приложения подписка будет автоматически импортирована и активирована.

## Особенности

- Сборка v2rayNG из официального репозитория
- Добавление URL подписки на этапе сборки
- Автоматический импорт подписки при первом запуске приложения
- Поддержка всех архитектур (arm64-v8a, armeabi-v7a, x86_64, x86)

## Использование

### Сборка Docker-образа

```bash
docker build --no-cache -t v2rayng-custom .
```

### Сборка APK с подпиской

```bash
docker run --rm -v $(pwd)/output:/output v2rayng-custom -PmyArgument=https://example.com/s/your-subscription-url
```

Где `https://example.com/s/your-subscription-url` - это URL вашей подписки.

APK-файлы будут скопированы в директорию `output/`.

### Дополнительные параметры сборки

Вы можете передать дополнительные параметры Gradle. Например:

```bash
docker run --rm -v $(pwd)/output:/output v2rayng-custom -PmyArgument=https://example.com/s/your-subscription-url --stacktrace --info --console=plain
```

## Как это работает

1. Docker-образ клонирует официальный репозиторий v2rayNG
2. Собирает необходимые зависимости, включая AndroidLibXrayLite
3. Модифицирует исходный код для добавления поддержки URL подписки:
   - Добавляет строковый ресурс с URL подписки
   - Создает файл в assets с URL подписки (резервный метод)
   - Модифицирует MainActivity для импорта подписки при первом запуске
4. Выполняет сборку приложения
5. Копирует собранные APK в указанную директорию

## Механизм автоматического импорта подписки

1. **Основной метод**: Через строковый ресурс `vpn_subscription_url`
2. **Резервный метод**: Через файл `subscription_url.txt` в директории assets

Это позволяет скрипту работать при изменениях в структуре кода оригинального приложения.

## Решение проблем

### Ошибка при сборке AndroidLibXrayLite

Если возникают ошибки на этапе сборки AndroidLibXrayLite, связанные с версиями Go или gomobile,
проверьте совместимость используемых версий в Dockerfile. Известные рабочие комбинации:

- Go 1.20.14 + gomobile v0.0.0-20231108080712-20b9621131a5

### Ошибка "toolchain not available"

Это обычно указывает на несовместимость между версиями Go и gomobile. Обновите Dockerfile,
чтобы использовать фиксированные версии обоих компонентов.
